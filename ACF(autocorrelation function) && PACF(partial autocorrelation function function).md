# What is the ACF & PACF
## Background
### ACF图：
需要先了解一个概念：**Autocorrelation Function (ACF)自相关函数**，指任意时间 t（t=1,2,3…n)的 序列值Xt 与其自身的滞后（这里取滞后一阶，即lag=1）值Xt-1之间的线性关系。这里有个简单的示例，可以更形象的解释Xt与Xt-1的变化：
![[Pasted image 20210806171708.png]]
那么**ACF图就是指👉以滞后值（上图就是滞后值为 1阶）为x轴，自相关系数（Xt与Xt-1的相关系数值）为y轴画出的图**，也叫做相关图。
### PACF图
同样PACF可以看下图更易理解：
![[Pasted image 20210806171800.png]]
## 为什么在PACF截尾，ACF拖尾的情况下，PACF更适合确定AR模型（p值）；而在ACF截尾，PACF拖尾的情况下，ACF更适合确定MA模型（q值）？
先看这样一个传悄悄话的例子：
![[Pasted image 20210806171856.png]]
我们可以看到，从 **“红色”** 衣服那个人开始，传递信息就已经被彻底打乱；PACF意义在于，从红色这个点切开，之前的蓝色和黄色参与者传递的语句还保留了原来悄悄话的大意，而红色之后就无意义。
回到AR模型这里，理论上PACF“关闭”了原始模型的顺序。这里的 **“关闭”** 指理论上自“关闭点”之后的这部分自相关都等于0。换句话说，**那非0部分的自相关则给出了AR模型的顺序。** 所以在PACF截尾的情况下，PACF图可以用来更好的确定AR模型。

于MA模型来说，PACF理论上不会关闭，只会以某种方式逐渐趋于0。所以这个时候要看ACF，因为仅含滞后阶数的模型的自相关是平均移动的。正如上面那个悄悄话的传递，黄色参与者说的“CV is cool”同绿色参与者说的“Naomi has a pool”是同样押韵的😂。
# 拖尾与截尾
拖尾是指序列以指数率单调递减或震荡衰减，而截尾指序列从某个时点变得非常小

![[Pasted image 20210806171008.png]]

出现以下情况，通常视为(偏)自相关系数d阶截尾：

-   在最初的d阶明显大于2倍标准差范围
-   之后几乎95%的(偏)自相关系数都落在2倍标准差范围以内
-   且由非零自相关系数衰减为在零附近小值波动的过程非常突然

![[Pasted image 20210806171018.png]]

出现以下情况，通常视为(偏)自相关系数拖尾：  
1）如果有超过5%的样本(偏)自相关系数都落入2倍标准差范围之外  
2）或者是由显著非0的(偏)自相关系数衰减为小值波动的过程比较缓慢或非常连续

![[Pasted image 20210806171027.png]]
## 如何用PACF图和ACF图来确定p、q值？
1. 首先需要通过PACF和ACF这两个图来判断是哪种模型，方法如下：
![[Pasted image 20210806172041.png]]
2. 然后当确定是什么模型后，再看上面的阶数和2倍标准差范围，就能找到对应p、q值。  
下面看几个示例图，首先是一个AR模型的（对，就是上篇博客里的那个）：
![[Pasted image 20210806172106.png]]

然后当确定是什么模型后，再看上面的阶数和2倍标准差范围，就能找到对应p、q值。  
下面看几个示例图，首先是一个AR模型的（对，就是上篇博客里的那个）：  
![](https://uploadfiles.nowcoder.com/images/20201204/550965516_1607060069585_3042F7526B3DCCFB32D455E06CE2C784)  
可以看到ACF是一个逐渐趋于0的拖尾，而PACF在7阶过后系数为0，所以模型是AR(7)或AR(8)，即ARMA(7,0）或ARMA（8,0)。备选模型ARMA(7,1）。  
再看一个MA模型的例子：  
![](https://uploadfiles.nowcoder.com/images/20201204/550965516_1607060069711_3042F7526B3DCCFB32D455E06CE2C784)  
只找到这样的图，可以看到PACF是拖尾，ACF自1阶过后都落在2倍标准差范围内，所以是MA(1)模型。  
最后看一个ARMA模型的例子：  
![](https://uploadfiles.nowcoder.com/images/20201204/550965516_1607060069834_3042F7526B3DCCFB32D455E06CE2C784)  
ACF和PACF都呈现拖尾，在1阶位置就开始基本落在2倍标准差范围，所以是ARMA(1,1)模型
# Reference
* [自相关系数 ACF与偏自相关系数PACF，拖尾和截尾](https://www.bbsmax.com/A/VGzlg8eNdb/)
* [如何根据自相关（ACF）图和偏自相关（PACF）图选择ARIMA模型的p、q值](https://blog.nowcoder.net/n/96cf91576b544214841df2e6f24545ba?from=nowcoder_improve)